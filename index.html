<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SafePay — Demo Escrow App (Buyer/Seller/Rider)</title>
<meta name="description" content="Clickable demo: buyer-seller-rider escrow flow (fintech style)"/>

<style>
  :root{
    --bg:#f7fbff;
    --card:#ffffff;
    --primary:#0b63ff; /* fintech blue */
    --accent:#062a4a;
    --muted:#7b8aa3;
    --success:#0aa060;
    --danger:#e23b3b;
    --glass: rgba(255,255,255,0.8);
    --radius:14px;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:linear-gradient(180deg,#f7fbff 0%, #eef6ff 100%);
    color:var(--accent);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:20px;
  }
  .app {
    width:100%;
    max-width:420px;
    background:var(--card);
    border-radius:18px;
    box-shadow:0 10px 30px rgba(9,30,66,0.08);
    overflow:hidden;
    padding:18px;
  }
  header{
    display:flex;
    gap:12px;
    align-items:center;
    padding:12px 6px;
  }
  .logo {
    width:52px;height:52px;border-radius:10px;
    background:linear-gradient(180deg,var(--primary),#0660d4);
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:26px;
    box-shadow:0 6px 18px rgba(11,99,255,0.16);
  }
  h1{margin:0;font-size:18px;line-height:1.05}
  p.sub{margin:4px 0 0;color:var(--muted);font-size:13px}
  .screen {padding:12px 6px 22px}
  .buttons {display:flex;gap:8px;margin:16px 0}
  button.btn{
    border:0;padding:12px 14px;border-radius:12px;font-weight:600;
    background:var(--primary);color:white;flex:1;font-size:15px;
    box-shadow:0 6px 14px rgba(11,99,255,0.12);
  }
  button.ghost{background:transparent;color:var(--primary);border:1px solid rgba(11,99,255,0.14);box-shadow:none}
  .role-select{display:flex;gap:8px;margin-top:10px}
  .role {flex:1;padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#f3f9ff);text-align:center;border:1px solid rgba(11,99,255,0.06);cursor:pointer}
  .role.active{border:2px solid var(--primary);box-shadow:0 6px 20px rgba(11,99,255,0.06)}
  .card{background:linear-gradient(180deg,var(--glass),#ffffff);border-radius:12px;padding:12px;margin:10px 0;border:1px solid rgba(9,30,66,0.04)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type=text], input[type=number]{
    width:100%;padding:10px;border-radius:10px;border:1px solid rgba(9,30,66,0.06);
    font-size:15px;margin-bottom:10px;
  }
  .mini {font-size:13px;color:var(--muted)}
  .muted {color:var(--muted)}
  .row{display:flex;gap:8px}
  .half{flex:1}
  .status {
    display:flex;align-items:center;gap:10px;font-weight:600;
    padding:10px;border-radius:10px;
  }
  .locked{background:#fff9f0;border:1px solid rgba(226,91,12,0.08);color:#d86a00}
  .released{background:#f0fff7;border:1px solid rgba(10,160,96,0.08);color:var(--success)}
  .map {
    height:220px;border-radius:10px;overflow:hidden;border:1px solid rgba(9,30,66,0.04);
    background:linear-gradient(180deg,#eaf5ff,#dff0ff);
    position:relative;padding:12px;
  }
  .map .route {position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .rider-dot {
    width:18px;height:18px;border-radius:9px;background:var(--primary);
    position:absolute;transform:translate(-50%,-50%);box-shadow:0 6px 16px rgba(11,99,255,0.18);
  }
  .small {font-size:13px;color:var(--muted)}
  .tx-list{max-height:120px;overflow:auto;padding-right:6px}
  .tx-item{padding:8px;border-bottom:1px dashed rgba(9,30,66,0.04);display:flex;justify-content:space-between;align-items:center}
  footer{display:flex;gap:8px;margin-top:10px}
  .kbd{background:#f3f6fb;border-radius:6px;padding:6px 8px;font-weight:700}
  .note{font-size:12px;color:var(--muted);margin-top:8px}
  @media (min-width:860px){
    body{padding:40px}
    .app{max-width:600px}
  }
</style>
</head>
<body>
  <main class="app" role="main" aria-label="SafePay Demo App">
    <header>
      <div class="logo">✓</div>
      <div>
        <h1>SafePay Demo</h1>
        <p class="sub">Safe payments · Secure deliveries — Fintech-style prototype</p>
      </div>
    </header>

    <section id="screens" class="screen">
      <!-- Screen: Role selection -->
      <div id="screen-role">
        <div class="card">
          <div class="mini">Choose your role</div>
          <div class="role-select" role="tablist">
            <div class="role" data-role="buyer" id="role-buyer">Buyer</div>
            <div class="role" data-role="seller" id="role-seller">Seller</div>
            <div class="role" data-role="rider" id="role-rider">Rider</div>
          </div>
          <div class="note">This demo stores data locally in your browser (no real payments).</div>
        </div>

        <div class="card">
          <div class="mini">Quick balances (demo wallets)</div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <div style="flex:1">
              <div class="small">Buyer Wallet</div>
              <div id="bal-buyer" style="font-weight:800;font-size:18px">₦50,000</div>
            </div>
            <div style="flex:1">
              <div class="small">Seller Wallet</div>
              <div id="bal-seller" style="font-weight:800;font-size:18px">₦2,500</div>
            </div>
            <div style="flex:1">
              <div class="small">Escrow</div>
              <div id="bal-escrow" style="font-weight:800;font-size:18px">₦0</div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn" id="enter-role-btn">Enter as selected role</button>
          <button class="ghost" id="reset-demo">Reset</button>
        </div>
      </div>

      <!-- Screen: Buyer Dashboard -->
      <div id="screen-buyer" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Welcome, Buyer</div>
              <div style="font-weight:800">Ready to pay securely</div>
            </div>
            <div style="text-align:right">
              <div class="small">Buyer wallet</div>
              <div id="buyer-wallet" style="font-weight:800">₦50,000</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="mini">Start a transaction</div>
          <label>Seller name (or handle)</label>
          <input id="buyer-seller" type="text" placeholder="@sellerhandle">
          <label>Price (₦)</label>
          <input id="buyer-price" type="number" placeholder="30000" min="1">
          <div class="row">
            <div class="half"><button class="btn" id="buyer-pay">Pay & Lock in Escrow</button></div>
            <div class="half"><button class="ghost" id="buyer-view-tx">My Transactions</button></div>
          </div>
          <div class="note">This will simulate locking funds into escrow until delivery is confirmed.</div>
        </div>

        <div class="card tx-list">
          <div class="small" style="margin-bottom:6px">Recent transactions</div>
          <div id="tx-list-buyer"></div>
        </div>

        <footer>
          <button class="ghost" id="buyer-back">Back</button>
        </footer>
      </div>

      <!-- Screen: Seller Dashboard -->
      <div id="screen-seller" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between">
            <div>
              <div class="small">Welcome, Seller</div>
              <div style="font-weight:800">Create a sale</div>
            </div>
            <div style="text-align:right">
              <div class="small">Seller wallet</div>
              <div id="seller-wallet" style="font-weight:800">₦2,500</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="mini">Create transaction (sell item)</div>
          <label>Product name</label>
          <input id="seller-product" type="text" placeholder="Example: Phone">
          <label>Price (₦)</label>
          <input id="seller-price" type="number" placeholder="30000" min="1">
          <div class="row">
            <div class="half"><button class="btn" id="seller-create">Create Listing</button></div>
            <div class="half"><button class="ghost" id="seller-incoming">Incoming Orders</button></div>
          </div>
          <div class="note">When buyer pays, funds move to Escrow and both parties see status.</div>
        </div>

        <div class="card tx-list">
          <div class="small" style="margin-bottom:6px">Orders / Transactions</div>
          <div id="tx-list-seller"></div>
        </div>

        <footer>
          <button class="ghost" id="seller-back">Back</button>
        </footer>
      </div>

      <!-- Screen: Rider Dashboard -->
      <div id="screen-rider" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between">
            <div>
              <div class="small">Rider Portal</div>
              <div style="font-weight:800">Assigned deliveries</div>
            </div>
            <div style="text-align:right">
              <div class="small">Earnings</div>
              <div id="rider-wallet" style="font-weight:800">₦0</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="mini">Available tasks</div>
          <div id="rider-tasks"></div>
          <div class="note">Click a task to start navigation / simulate arrival.</div>
        </div>

        <div class="card">
          <div class="mini">Confirm delivery</div>
          <label>Enter buyer code</label>
          <input id="rider-code" type="text" placeholder="e.g. 5G7R2">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="rider-confirm">Confirm Delivery</button>
            <button class="ghost" id="rider-refresh">Refresh Tasks</button>
          </div>
        </div>

        <footer>
          <button class="ghost" id="rider-back">Back</button>
        </footer>
      </div>

      <!-- Screen: Transaction Details / Tracking -->
      <div id="screen-tracking" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between">
            <div>
              <div class="small">Transaction</div>
              <div id="tx-title" style="font-weight:800">#TX12345</div>
              <div class="small muted" id="tx-status">Status: Created</div>
            </div>
            <div style="text-align:right">
              <div class="small">Escrow</div>
              <div id="tx-amount" style="font-weight:800">₦0</div>
            </div>
          </div>
        </div>

        <div class="map card" id="map-area">
          <!-- Simulated map -->
          <div class="route" aria-hidden="true">
            <svg width="100%" height="100%" viewBox="0 0 240 120" preserveAspectRatio="none">
              <defs>
                <linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#d9eaff"/><stop offset="1" stop-color="#eff8ff"/></linearGradient>
              </defs>
              <rect x="0" y="0" width="100%" height="100%" fill="url(#g)"/>
              <g id="map-icons" fill="#234a7a" opacity="0.85">
                <circle cx="28" cy="95" r="6"/> <!-- seller -->
                <text x="28" y="85" font-size="10" text-anchor="middle">Seller</text>
                <circle cx="215" cy="20" r="6" fill="#0b63ff"/> <!-- buyer -->
                <text x="215" y="10" font-size="10" text-anchor="middle">Buyer</text>
              </g>
            </svg>
          </div>
          <div id="rider-dot" class="rider-dot" style="left:28px;top:95px"></div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Delivery code</div>
              <div id="tx-code" style="font-weight:900;font-size:18px" class="kbd">—</div>
            </div>
            <div>
              <div class="small">Assigned rider</div>
              <div id="tx-rider">—</div>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button class="btn" id="simulate-move">Simulate Rider Move</button>
            <button class="ghost" id="simulate-arrive">Simulate Arrival (auto)</button>
          </div>
        </div>

        <footer>
          <button class="ghost" id="tracking-back">Back</button>
        </footer>
      </div>

    </section>
  </main>

<script>
/*
  SafePay Demo - Single file prototype
  - client-only simulation
  - Replace mock actions with real APIs for production
*/

// --- Demo state (stored in localStorage) ---
const DEFAULT_STATE = {
  buyerBal: 50000,
  sellerBal: 2500,
  escrow: 0,
  riderBal: 0,
  txs: [], // transactions
  nextTxId: 1001
};

function loadState(){
  let raw = localStorage.getItem('safepay_demo_state');
  if (!raw) {
    localStorage.setItem('safepay_demo_state', JSON.stringify(DEFAULT_STATE));
    return JSON.parse(JSON.stringify(DEFAULT_STATE));
  }
  try { return JSON.parse(raw); } catch(e){ localStorage.setItem('safepay_demo_state', JSON.stringify(DEFAULT_STATE)); return JSON.parse(JSON.stringify(DEFAULT_STATE)); }
}
function saveState(){
  localStorage.setItem('safepay_demo_state', JSON.stringify(state));
}
let state = loadState();

// --- UI helpers ---
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function formatN(amount){ return '₦' + Number(amount).toLocaleString(); }
function el(tag, attrs={}, text=''){ const e = document.createElement(tag); for(let k in attrs) e.setAttribute(k, attrs[k]); if(text) e.textContent=text; return e; }

// init balances display
function renderBalances(){
  $('#bal-buyer').textContent = formatN(state.buyerBal);
  $('#bal-seller').textContent = formatN(state.sellerBal);
  $('#bal-escrow').textContent = formatN(state.escrow);
  $('#buyer-wallet').textContent = formatN(state.buyerBal);
  $('#seller-wallet').textContent = formatN(state.sellerBal);
  $('#rider-wallet').textContent = formatN(state.riderBal);
}
renderBalances();

// screens management
const SCREENS = {
  role: $('#screen-role'),
  buyer: $('#screen-buyer'),
  seller: $('#screen-seller'),
  rider: $('#screen-rider'),
  tracking: $('#screen-tracking')
};
let currentRole = 'buyer';
let currentTx = null;

function showScreen(name){
  for(const k in SCREENS) SCREENS[k].style.display = 'none';
  SCREENS[name].style.display = '';
}

// role selection
$$('.role').forEach(elm => {
  elm.addEventListener('click', () => {
    $$('.role').forEach(r=>r.classList.remove('active'));
    elm.classList.add('active');
    currentRole = elm.dataset.role;
  });
});
$('#role-buyer').classList.add('active'); // default

$('#enter-role-btn').addEventListener('click', () => {
  if (currentRole === 'buyer') {
    showScreen('buyer');
    renderBuyerTxs();
  } else if (currentRole === 'seller') {
    showScreen('seller');
    renderSellerTxs();
  } else {
    showScreen('rider');
    renderRiderTasks();
  }
});

// reset demo
$('#reset-demo').addEventListener('click', () => {
  if (!confirm('Reset demo data?')) return;
  localStorage.removeItem('safepay_demo_state');
  state = loadState();
  renderBalances();
  alert('Demo reset. Reloading page.');
  location.reload();
});

// ------------------- Buyer Actions -------------------
function addTx(tx){ state.txs.unshift(tx); state.nextTxId++; saveState(); renderBalances(); }

$('#buyer-pay').addEventListener('click', () => {
  const sellerHandle = $('#buyer-seller').value.trim() || 'seller123';
  const price = Number($('#buyer-price').value) || 30000;
  if (price <= 0) return alert('Please enter a valid price.');

  if (state.buyerBal < price) return alert('Insufficient buyer balance in demo.');

  // simulate payment -> lock into escrow
  state.buyerBal -= price;
  state.escrow += price;

  const txId = 'TX' + state.nextTxId;
  const code = generateCode();
  const tx = {
    id: txId, seller: sellerHandle, price, status: 'Escrow Locked', code,
    riderAssigned: null, riderStatus: 'unassigned', createdAt: Date.now()
  };
  addTx(tx);
  saveState();

  // update UI and show tracking screen
  currentTx = tx;
  renderBalances();
  alert(`Payment successful. Funds locked in escrow for ${txId}.\nDelivery code: ${code}`);
  openTracking(tx);
});

function renderBuyerTxs(){
  const list = $('#tx-list-buyer'); list.innerHTML = '';
  if (state.txs.length === 0){ list.innerHTML = '<div class="small muted">No transactions yet</div>'; return; }
  for(const tx of state.txs){
    const item = el('div',{class:'tx-item'});
    const left = el('div');
    left.innerHTML = `<div style="font-weight:700">${tx.id} · ${tx.seller}</div><div class="small">${tx.status}</div>`;
    const right = el('div'); right.innerHTML = `<div style="font-weight:800">${formatN(tx.price)}</div>`;
    item.appendChild(left); item.appendChild(right);
    item.addEventListener('click', ()=>{ openTracking(tx); });
    list.appendChild(item);
  }
}

// ------------------- Seller Actions -------------------
$('#seller-create').addEventListener('click', () => {
  const product = $('#seller-product').value.trim() || 'Goods';
  const price = Number($('#seller-price').value) || 30000;
  const txId = 'TX' + state.nextTxId;
  const code = generateCode();
  const tx = {
    id: txId, seller: 'you-'+product, price, product, status: 'Waiting for buyer',
    code, riderAssigned: null, riderStatus:'unassigned', createdAt: Date.now()
  };
  addTx(tx);
  alert(`Listing created. Share ${tx.id} with buyer.\nExample: ${tx.id} · ${formatN(price)}`);
  renderSellerTxs();
});

function renderSellerTxs(){
  const list = $('#tx-list-seller'); list.innerHTML = '';
  if (state.txs.length === 0){ list.innerHTML = '<div class="small muted">No orders</div>'; return; }
  for(const tx of state.txs){
    const item = el('div',{class:'tx-item'});
    const left = el('div'); left.innerHTML = `<div style="font-weight:700">${tx.id}</div><div class="small">${tx.seller} · ${tx.status}</div>`;
    const right = el('div'); right.innerHTML = `<div style="font-weight:800">${formatN(tx.price)}</div>`;
    item.appendChild(left); item.appendChild(right);
    item.addEventListener('click', ()=>{ openTracking(tx); });
    list.appendChild(item);
  }
}

// ------------------- Rider Actions -------------------
function renderRiderTasks(){
  const container = $('#rider-tasks'); container.innerHTML = '';
  const tasks = state.txs.filter(t => t.riderStatus === 'unassigned' && t.status === 'Escrow Locked');
  if (tasks.length === 0){
    container.innerHTML = '<div class="small muted">No assigned tasks. Wait for orders with escrow locked.</div>';
    return;
  }
  for(const t of tasks){
    const row = el('div',{class:'tx-item'});
    row.innerHTML = `<div><div style="font-weight:700">${t.id}</div><div class="small">${t.seller}</div></div>
                     <div><button class="btn" data-tx="${t.id}" style="padding:6px 8px;font-size:13px">Take</button></div>`;
    container.appendChild(row);
  }
  container.querySelectorAll('button').forEach(b=>{
    b.addEventListener('click', ()=> {
      const txid = b.dataset.tx;
      assignRider(txid, 'Rider-' + Math.floor(Math.random()*900+100));
      renderRiderTasks();
      alert('Task assigned. Open Tracking to simulate movement.');
    });
  });
}

$('#rider-refresh').addEventListener('click', renderRiderTasks);

$('#rider-confirm').addEventListener('click', () => {
  const code = $('#rider-code').value.trim();
  if(!code) return alert('Enter delivery code from buyer.');
  const match = state.txs.find(t => t.code === code && t.status === 'In Transit');
  if(!match) return alert('Invalid code or this transaction is not in transit.');

  // confirm delivery: release escrow to seller, pay rider fee
  confirmDelivery(match);
  alert(`${match.id} confirmed. Funds released to seller.`);
  renderBalances();
  renderRiderTasks();
});

// ------------------- Tracking & Map Simulation -------------------
function openTracking(tx){
  currentTx = tx;
  // show tracking screen data
  $('#tx-title').textContent = tx.id + ' · ' + (tx.product || tx.seller);
  $('#tx-status').textContent = 'Status: ' + tx.status;
  $('#tx-amount').textContent = formatN(tx.price);
  $('#tx-code').textContent = tx.code || '—';
  $('#tx-rider').textContent = tx.riderAssigned || '—';
  showScreen('tracking');
  // place rider-dot at seller area if unassigned or at buyer if arrived
  placeRiderDot(tx);
}

function placeRiderDot(tx){
  const dot = $('#rider-dot');
  if(tx.riderStatus === 'unassigned'){
    dot.style.left = '28px'; dot.style.top = '95px';
  } else if(tx.riderStatus === 'to_buyer' || tx.status === 'In Transit'){
    // place somewhere between seller(28,95) and buyer(215,20) using tx.progress
    tx.progress = tx.progress || 0;
    const sx=28, sy=95, bx=215, by=20;
    const x = sx + (bx-sx) * (tx.progress/100);
    const y = sy + (by-sy) * (tx.progress/100);
    dot.style.left = x+'px'; dot.style.top = y+'px';
  } else if(tx.status === 'Delivered'){
    dot.style.left = '215px'; dot.style.top = '20px';
  }
}

$('#simulate-move').addEventListener('click', () => {
  if(!currentTx) return alert('Open a transaction first.');
  if(!currentTx.riderAssigned) return alert('Assign a rider first (go to Rider role and take task).');

  if(currentTx.status === 'Escrow Locked' || currentTx.status === 'Waiting for Rider'){
    currentTx.status = 'In Transit';
    currentTx.riderStatus = 'to_buyer';
    currentTx.progress = 0;
    saveState();
  }
  // animate progress
  let p = currentTx.progress || 0;
  const interval = setInterval(()=>{
    p += Math.random()*12 + 6;
    if(p >= 100){ p = 100; clearInterval(interval); currentTx.progress = 100; saveState(); placeRiderDot(currentTx); alert('Rider arrived near buyer. Buyer should give code to rider.'); }
    currentTx.progress = p; saveState(); placeRiderDot(currentTx);
  }, 500);
});

$('#simulate-arrive').addEventListener('click', () => {
  if(!currentTx) return alert('Open a transaction first.');
  if(!currentTx.riderAssigned) return alert('Assign a rider first.');
  // set arrived
  currentTx.progress = 100; currentTx.status = 'In Transit'; currentTx.riderStatus = 'arrived';
  saveState();
  placeRiderDot(currentTx);
  alert('Rider marked as arrived. Buyer gives code to rider who then confirms in Rider portal.');
});

// Assign rider to tx
function assignRider(txid, riderName){
  const tx = state.txs.find(t=>t.id===txid);
  if(!tx) return;
  tx.riderAssigned = riderName;
  tx.riderStatus = 'assigned';
  tx.status = 'Escrow Locked'; // funds already locked
  saveState();
  currentTx = tx;
}

// Confirm delivery & release escrow
function confirmDelivery(tx){
  // release funds: escrow -> seller
  state.escrow -= tx.price;
  state.sellerBal += tx.price;
  // rider gets small fee (demo 2%)
  const riderFee = Math.round(tx.price * 0.02);
  state.riderBal += riderFee;
  // mark tx delivered
  tx.status = 'Delivered';
  tx.riderStatus = 'delivered';
  tx.deliveredAt = Date.now();
  // save and update
  saveState();
  renderBalances();
  renderSellerTxs();
  renderBuyerTxs();
  placeRiderDot(tx);
}

// generate code
function generateCode(){
  const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789';
  let out = '';
  for(let i=0;i<5;i++) out += chars.charAt(Math.floor(Math.random()*chars.length));
  return out;
}

// tracking back
$('#tracking-back').addEventListener('click', () => {
  if(currentRole === 'buyer') showScreen('buyer');
  else if(currentRole === 'seller') showScreen('seller');
  else showScreen('rider');
});

// back buttons
$('#buyer-back').addEventListener('click', ()=>showScreen('role'));
$('#seller-back').addEventListener('click', ()=>showScreen('role'));
$('#rider-back').addEventListener('click', ()=>showScreen('role'));

// open tx from txlist when clicking
// (already wired by item click calling openTracking)

// populate saved transactions on load
function startupRender(){
  renderBalances();
  renderBuyerTxs();
  renderSellerTxs();
  renderRiderTasks();
}
startupRender();

// autos-save on unload
window.addEventListener('beforeunload', saveState);

// small convenience: populate buyer price if user clicked seller listing
$('#buyer-view-tx').addEventListener('click', () => {
  // open most recent tx for buyer (simulate buying first available listed tx)
  const candidate = state.txs.find(t => t.status === 'Waiting for buyer') || state.txs[0];
  if(!candidate) return alert('No listings available to buy in demo. Seller should create one first.');
  $('#buyer-seller').value = candidate.seller;
  $('#buyer-price').value = candidate.price;
  alert('Buyer form pre-filled from listing: ' + candidate.id);
});

</script>

</body>
</html>
